const Nenge=new class{version=1;DB_NAME="XBBS";DB_STORE_MAP={"data-js":{timestamp:!1},"data-file":{},avatar:{timestamp:!1},forumsicon:{timestamp:!1},document:{timestamp:!1}};constructor(){const e=this,t=e.I;self.Nenge=e,e.language=t.language,e.i18nName=t.i18n,e.on(window,"error",(e=>{t.mobile&&alert(e.message)})),e.triger(document,"NengeStart",e),e.docload((t=>e.triger(document,"NengeReady",e)))}LibStore="data-js";maxsize=104857600;part="-part-";lang={};action={k:console.log};StoreTable={};JSpath=document.currentScript&&document.currentScript.src.split("/").slice(0,-1).join("/")+"/";get date(){return new Date}get time(){return this.date.getTime()}get rand(){return Math.random()}get randNum(){return this.I.Int(this.rand.toString().slice(2))}async getItem(e,t,s,r={}){if(!t)return await this.getAllData(e,1,r);let n=this,a=n.F,i=n.I,o=n.maxsize,l=n.part,c=await a.dbGetItem(i.assign({store:e,name:t},r)),d=t.split(l)[0];if(c){if(s&&c.version&&c.version!=s)c=void 0;else if(c.contents&&c.filesize&&c.filesize>o){let s=i.U8(c.filesize);await i.Async(i.Part(c.filesize/o,d).map((async(d,u)=>{let h=d;if(u>0&&(h+=l+u),h==t)s.set(c.contents,u*o);else{let t=await a.dbGetItem(i.assign(r,{store:e,name:h}));t?s.set(t.contents,u*o):n.Err("lost file")}}))),c.contents=s}c&&c.contents&&i.u8buf(c.contents)&&("unpack"==c.type?(c.password&&(r.password=c.password),c.contents=await a.unFile(c.contents,r)):"File"==c.type?c.contents=new File([c.contents],c.filename||d,{type:c.filetype||a.getMime(c.filename||d)}):"String"==c.type&&(c.contents=i.decode(c.contents)))}return c}async setItem(e,t,s,r){let n=this,a=n.F,i=n.I,o=n.maxsize,l=n.part;if((s=await a.dbCheckSize(s,o)).contents&&s.contents.byteLength>o){let n=s.contents.byteLength,c={};return i.toArr(s,(e=>{"contents"!=e[0]&&(c[e[0]]=e[1])})),await i.Async(i.Part(n/o,t).map((async(t,d)=>{let u=t,h=d*o;return d>0&&(u+=l+d),await a.dbPutItem({store:e,data:i.assign({contents:i.U8(s.contents.subarray(h,n-h>=o?h+o:n))},c),name:u,dbName:r})})))}return await a.dbPutItem({store:e,data:s,name:t,dbName:r})}async removeItem(e,t,s){let{clear:r,dbName:n}=s||{},a=this,i=a.I,o=a.F;if(r){let r=await o.dbGetItem(i.assign({store:e,name:t},s));if(r&&r.filesize)return await i.Async(i.Part(r.filesize/a.maxsize,t.split(a.part)[0]).map((async(t,s)=>{let r=t;return s>0&&(r+=a.part+s),await o.dbRemoveItem({store:e,name:r})+"\n"})))}return await o.dbRemoveItem({store:e,name:t,dbName:n})}async getAllData(e,t,s){return e?await this.F.dbGetAll(this.I.assign({store:e,only:t},s)):{}}async getContent(e,t,s,r){let n=await this.getItem(e,t,s,r);return n&&n.contents||n}async setContent(e,t,s,r,n){let a=this.I.assign(r||{},{contents:s,timestamp:this.date});return await this.setItem(e,t,a,n)}async getAllKeys(e,t,s){return await this.F.dbGetKeys(this.I.assign({store:e,dbName:t},s||{}))}async getAllCursor(e,t,s,r){return await this.F.dbGetCursor(this.I.assign({store:e,index:t,only:s},r))}async clearDB(e,t){let s=this.F;if(e)return s.I.str(e)&&(e=[e]),await s.dbRemoveTable(e,t)}async deleteDB(e,t){let s=this.F;return s.I.str(e)&&(e=[e]),await s.deleteDatabase(e,t)}getStore(e,t){if(!e)return;let s=this;if(e instanceof s.F.StoreDatabase)return e;t=t||s.DB_NAME,s.StoreTable[t]||(s.StoreTable[t]={});let r=s.F,n=s.StoreTable[t];return n[e]||(n[e]=new r.StoreDatabase(s,e,t)),n[e]}async FetchItem(e){let t=this,s=t.F,r=t.I;e&&!r.str(e)||(e={url:e||"/"});let n,a,i,o="arrayBuffer",l=s.getname(e.url),c=e.key||l||"index.php",d=e.key==s.LibKey?c+l:c,u=e.version,h={},p=e.store&&t.getStore(e.store),m=(t,n)=>s.unFile(t,r.assign(e,{password:n})),b=async s=>(s&&s.contents&&("unpack"==s.type?(s=await m(s.contents,s.password)).password&&delete s.password:s=s.contents),g(s),t.null(e),e=null,s),g=t=>t&&e.success&&e.success(t,h);if(e.filename||(e.filename=l),e.onLine&&(e.unset=navigator.onLine),p&&(n=await p.get(d,u,e),n&&!e.unset&&!e.checksize))return b(n);if(a=await s.FetchStart(e).catch((t=>e.error&&e.error(t.message))),!a)return b(n);h=s.FetchHeader(a,e),r.exends(h,a,["url","status","statusText"]),e.filename&&(h.filename=e.filename);let y=h.password||e.password||void 0;if(200!=a.status)return a.body&&(a.body.cancel(),e.error&&e.error(a.statusText,h)),"head"==e.type&&g(h),b(n);if(n&&n.filesize&&h.byteLength>0){if(n.filesize==h.byteLength)return a.body.cancel(),b(n);n=null}else if("head"==e.type)return a.body.cancel(),b(h);let f=r.func(e.process)?await s.StreamResponse(a,e.process,h):a;e.unpack&&(e.type=o),e.type=e.type||o,i=await f[e.type]();let w=h.type,v=h.byteLength||0,I=h["content-type"];if(e.type==o&&r.buf(i)&&(i=r.U8(i),e.Filter&&(i=e.Filter(i)),w=r.N(11),v=i.byteLength,e.autounpack&&v<.3*t.maxsize&&(e.unpack=!0)),e.dataOption=e.dataOption||{},p&&e.unpack&&c===d&&v>t.maxsize&&(w="unpack",await p.put(d,r.assign({contents:i,timestamp:new Date,filesize:v,filetype:I,version:u,type:w,password:y},e.dataOption)),p=null),e.unpack&&r.u8buf(i)&&(i=await m(i,y),i.byteLength||(i.password&&(y=i.password,delete i.password),w="datalist")),!0===e.decode)e.decode=r.decode;else if(r.str(e.decode)){const t=e.decode;e.decode=e=>r.decode(e,t)}if(p&&c!==d){if(r.u8buf(i))i=s.getFileText(i,e.decode,e.mime||h["content-type"]||s.getMime(""),l),w="File";else if(r.str(i))w=h["content-type"]||"String";else if("datalist"==w){let n;await r.Async(r.toArr(i).map((async a=>{let[i,o]=a,l=s.getname(i),c=s.getMime(l),d=s.getFileText(o,e.decode,c,l);return await p.put(e.key+l,r.assign({contents:d,timestamp:t.date,filesize:o.byteLength,filetype:c,version:t.version,type:r.blob(d)?"File":"String"},e.dataOption)),e.filename==l&&(n=d),!0}))),n&&(i=n),n=null,p=null}}else e.decode&&(i=s.getFileText(i,e.decode,w),r.str(i)&&(w="String"));return p&&await p.put(d,r.assign({contents:i,timestamp:t.date,filesize:v,filetype:I,version:u,type:w,password:y},e.dataOption)),b(i)}ajax(e){let t=this,s=t.I;t.F;return s.str(e)&&(e={url:e}),s.Async((r=>{const n=new XMLHttpRequest(e.paramsDictionary);t.on(n,"error",(t=>{e.error&&e.error("net::ERR_FAILED"),r(null)})),t.on(n,"readystatechange",(t=>{switch(n.readyState){case n.LOADING:case n.OPENED:case n.UNSENT:break;case n.HEADERS_RECEIVED:if(s.defines(n,{headers:s.toObj((n.getAllResponseHeaders()||"").trim().split(/[\r\n]+/).map((e=>{let t=e.split(": ");return[t.shift(),t.join(": ")]})).concat([["status",n.status],["statusText",n.statusText],["url",l]]))},1,1),"head"==e.type)return n.abort(),e.success&&e.success(n.headers),void r(n.headers);break;case n.DONE:200==n.status?(e.success&&e.success(n.response,n.headers,n),r(n.response)):n.status>0&&(e.error&&e.error(n.statusText,n.headers,n),r(null));break}})),e.process&&t.on(n,"progress",(t=>e.process(s.PER(t.loaded,t.total),t.total,t.loaded,0,n))),e.postProcess&&t.on(n.upload,"progress",(t=>e.postProcess(s.PER(t.loaded,t.total),t.total,t.loaded,t)));let a=["abort","load","loadend","loadstart","progress","readystatechange","timeout"];a.forEach((s=>e[s]&&t.on(n,s,(t=>e[s](t,n))))),n.upload&&e.upload&&a.forEach((s=>e.upload[s]&&t.on(n.upload,s,(t=>e.upload[s](t,n)))));let i,o=e.type||"",l=s.get(e.url,{inajax:t.time},e.get||void 0);e.json?(i=JSON.stringify(e.json),e.headers=s.assign({accept:"application/json, text/plain, */*"},e.headers)):e.post&&(i=s.post(e.post)),e.overType&&n.overrideMimeType(e.overType),"head"!=o&&(n.responseType=o),n.open(i?"POST":"GET",l),e.headers&&s.toArr(e.headers,(e=>n.setRequestHeader(e[0],e[1]))),n.send(i)}))}runaction(e,t){const s=this,r=s.action,n=s.I||self.Nenge.I;if(r&&r[e])return n.func(r[e])?n.array(t)?r[e].apply(s,t):r[e].apply(s,n.toArr(arguments).slice(1)):r[e]}callaction(e,...t){const s=this,r=s.action,n=s.I||self.Nenge.I;if(r&&r[e])return n.func(r[e])?Reflect.apply(r[e],s,t):r[e]}bindaction(e){const t=this,s=t.action,r=t.I||self.Nenge.I;if(s&&s[e])return r.func(s[e])?s[e].bind(t):s[e]}addJS(e,t,s,r){let n=this,a=n.F,i=n.I;if(i.blob(e)&&(r=a.getKeyName(e.name),"text/css"==e.type&&(s=!0)),r&&n.$("#link_"+r))return;let o=!1,l=n.$ce(s?"link":"script"),c=t=>{/^(blob:)?https?:\/\//.test(e)||/(\.js$|\.css$)/.test(e)||(o=!0,e=a.URL(e,a.getMime(s?"css":"js"))),s?(l.type=a.getMime("css"),l.href=e,l.rel="stylesheet"):(l.type=a.getMime("js"),l.src=e),r&&l.setAttribute("id","link_"+r),l.onload=r=>{t&&t(r),o&&a.removeURL(e),e=null,s||l.remove()},document[s?"head":"body"].appendChild(l)};return t?(c(t),l):i.Async(((e,t)=>c(e)))}async loadScript(e,t,s,r){t=t||{};let n=this,a=n.F;t.url=a.getpath(e),s?t.type="text":(t.store||(t.store=n.LibStore),t.key||(t.key=a.LibKey)),t.version=t.version||n.version;let i=await n.FetchItem(t);return s?i:await n.addJS(i)}async getScript(e,t){return this.loadScript(e,t,!0)}async addScript(e,t){return await T.addJS(await T.getScript(e,t))}async loadLibjs(e,t){let s=this.F;return await this.addJS(await s.getLibjs(e,t),null,"css"==s.getExt(e))}unFile(e,t,s){return this.F.unFile(e,this.I.assign({process:t},s||{}))}async toZip(e,t,s){let r=this,n=r.I;return n.Async((async a=>{let i=new Worker(r.JSpath+"zip.js?"+r.time);r.on(i,"message",(e=>{let s=e.data;1==s.t?(a(s.contents),e.target.terminate()):2==s.t&&t&&t(n.PER(s.current,s.total))})),r.on(i,"error",(e=>{a(null),i.terminate()})),i.postMessage(n.assign({contents:e},s||{})),e=null}))}on(e,t,s,r,n){let a=this;a.F.getevent(t).forEach((t=>a.$(e).addEventListener(t,s,!1===r?{passive:!1}:r,n)))}un(e,t,s,r,n){let a=this;a.F.getevent(t).forEach((t=>a.$(e).removeEventListener(t,s,!1===r?{passive:!1}:r,n)))}once(e,t,s,r){return this.on(e,t,s,{passive:!1,once:!0},r)}docload(e){let t=this,s=document;return"complete"==s.readyState?e&&e.call(t):t.I.Async((r=>{let n=()=>{e&&e.call(t),r(t)};"loading"==s.readyState?t.once(s,"DOMContentLoaded",n):n()}))}$(e,t){let s=this.I;return e?s.str(e)?s.$(e,t):s.func(e)?this.docload(e):e:void 0}$$(e,t){return this.I.$$(e,t)}$ce(e){return this.I.$c(e)}$ct(e,t,s){let r=this,n=r.I,a=r.$ce(e);return a.innerHTML=n.str(t)?t:t(),s&&n.toArr(r.F.getevent(s),(e=>a.classList.add(e))),a}$ca(e,t){let s=this.$ce(e);return this.I.toArr(t,(e=>s.setAttribute(e[0],e[1]))),s}$append(e,t){return this.I.str(t)&&(t=this.$ce(t)),e.appendChild(t),t}$add(e,t){return e.classList.add(t),e}customElement(e){let t=this;window.customElements.define(e,class extends HTMLElement{constructor(){super(),t.callaction("TAG-"+this.tagName,this,"init")}connectedCallback(){t.callaction("TAG-"+this.tagName,this,"connect")}attributeChangedCallback(e,s,r){t.callaction("TAG-"+this.tagName,this,"attribute",{name:e,oldValue:s,newValue:r})}disconnectedCallback(){t.callaction("TAG-"+this.tagName,this,"disconnect")}})}attr(e,t){return this.$(e).getAttribute(t)}docElm(e,t){return(new DOMParser).parseFromString(e,t||"text/html")}HTMLToTxt(e,t){let s=this.I;return s.str(e)&&(e=this.docElm(e)),s.doc(e)?e.body[t?"innerHTML":"textContent"]:""}fragment(){return new DocumentFragment}Err(e){return new Error(e)}down(e,t,s){return this.F.download(e,t,s)}getLang(e,t){let s=this,r=s.lang&&s.lang[e]||e;return this.lang[e],t&&r?s.I.RegRe(r,t):r}triger(e,t,s,r){let n=this,a=n.I;return a.str(e)&&(e=n.$(e)),a.str(t)?n.dispatch(e,new a.O[22](t,a.assign({},r,s&&{detail:s}))):n.dispatch(e,t),e}dispatch(e,t){return e.dispatchEvent(t),e}stopGesture(e){let t=this;return t.I.toArr(["gesturestart","gesturechange","gestureend"],(s=>t.on(e,s,(e=>t.stopEvent(e))))),e}stopEvent(e){e.preventDefault()}stopProp(e){e.preventDefault(),e.stopPropagation()}null(e){for(var t in e)e[t]=null,delete e[t]}I=new class{O=[Array,Object,Element,HTMLFormElement,FormData,URLSearchParams,NamedNodeMap,DOMStringMap,CSSStyleDeclaration,Document,ArrayBuffer,Uint8Array,Promise,Blob,File,String,DOMRect,Event,KeyboardEvent,Function,Boolean,Headers,CustomEvent,HTMLCollection,FileList,TextDecoder,TextEncoder,NodeList,Number,RegExp];constructor(){let e=this,t=e.O,s="",r="return ",n=r+"o",a=r+"this.",i=a+"toArr(",o=t=>r+e.N(t)+".",l=t=>"new "+e.N(t),c=e=>r+l(e)+"(o)",d=(t,s)=>u(t,r+"this.C(o) === "+e.N(s)),u=(e,t)=>t?`'${e}':{value(o,...a){${t}}},`:"",h=(t,s,r)=>s?u(e.N(t)+(r?"2obj":"2arr"),s):"",p=t=>a+e.N(t)+"2obj(o)",m=t=>a+e.N(t)+"2arr(o)",b=t=>a+"entries(this."+e.N(t)+"2obj(o))",g=t=>a+"FromEntries(this."+e.N(t)+"2arr(o))",y=e=>`return this.ArrFrom(${e})`,f="document",w=r+"(a[0]||"+f+").querySelector",v=y("o");t[1].entries({2:"elm",3:"elmform",4:"urlpost",5:"urlget",6:"nodemap",7:"DOMmap",8:"elmCss",12:"await",13:"blob",14:"file",17:"evt",18:"keyevt",19:"func",21:"header",27:"nodelist"}).forEach((t=>{return s+=(n=t[1],a=t[0],u(n,r+"o instanceof "+e.N(a)));var n,a})),t[1].entries({0:"array",1:"obj",9:"doc",10:"buf",11:["u8obj","u8buf"],15:"str",20:"bool",28:"num"}).forEach((e=>s+=e[1]instanceof t[0]?e[1].map((t=>d(t,e[0]))).join(""):d(e[1],e[0]))),t[1].entries({null:n+"===null",none:r+'typeof o == "undefined"',R:r+"Reflect.construct(this.O[o],a)",H:r+"a[0]&&o.hasOwnProperty(a[0])||false",DP:r+"Reflect.deleteProperty(o,a[0])",Arr:c(0),ArrFrom:o(0)+"from(o)",entries:o(1)+"entries(o)",FromEntries:o(1)+"fromEntries(o)",Keys:o(1)+"keys(o);",FromObj:o(1)+"fromEntries(o);",U8:a+"u8buf(o)?o:"+l(11)+"(o.buffer||o)",buf16str:i+'o).map(v => v.toString(16).padStart(2,0).toLocaleUpperCase()).join("")',ArrTest:i+"o).filter(entry => entry[1].test(a[0]))[0]",decode:r+l(25)+"(a[0]).decode(o)",encode:r+l(26)+"().encode(o)",FormPost:c(4),FormGet:c(5),Int:c(28),IntVal:r+"parseInt(o,a[0])",IntSize:"o=this.Int(o);",PER:a+'Int(100*o/a[0]).toFixed(0)+"%"',Async:n+"?(this.array(o) ? "+e.N(12)+".all(o):new "+e.N(12)+"(o,a[0])):null;",$:w+"(o)",$$:w+"All(o)",$c:r+f+".createElement(o)",RegRe:i+"a[0],e=>o=o.replace("+l(29)+'("\\{"+e[0]+"\\}","g"),e[1])),o',elmdata:a+"toObj(o&&o.dataset||{})||{}",Part:i+"Math.ceil(o)).fill(a[0])",setStyle:a+"toArr(a[0],x=>(o.style||o).setProperty(x[0],x[1])),o"}).forEach((e=>s+=u(e[0],e[1]))),t[1].entries({4:["var s = {};o.forEach((t, e) => {s[e] ? (this.array(s[e]) || (s[e] = [s[e]]), s[e].push(t)) : s[e] = t});return s",b(4)],5:[p(4),m(4)],6:[g(6),v+".map(v=>[v.name,v.value])"],7:[o(1)+"assign({}, o)",b(7)],8:[g(8),v+".map(v=>[v,o.getPropertyValue(v)])"],10:[n,y("this.U8(o)")],11:[n,v],16:[r+"o.toJSON()",b(16)],21:[p(4),m(4)],23:[n,v],24:[n,v],27:[n,v],28:[n,y('"".padStart(o)')]}).forEach((e=>s+=h(e[0],e[1][0],1)+h(e[0],e[1][1]))),new t[19]("I",e.N(1)+".defineProperties(I,{"+s+"})")(e)}N(e){return isNaN(e)?this.X(e):this.O[e].name}C(e){return null!=e&&null!=e&&e.constructor}X(e){return this.C(e)&&this.C(e).name||""}assign(){return this.O[1].assign.apply(null,arguments)}exends(e,t,s){return s?this.toArr(s,(s=>e[s]=t[s])):e=this.assign(e,t),e}get mobile(){return"ontouchend"in document}get language(){return navigator.language}get i18n(){let e=this.language.split("-");return e="zh"==e[0]?"CN"==e[1]?"zh-hans":"zh-hant":e[0],e}post(e){let t=this,s=t.urlpost(e)?e:t.FormPost(t.elmform(e)?e:t.str(e)?t.$(e):void 0);return t.obj(e)&&t.toArr(e,(e=>s.append(e[0],e[1]))),s}get(e,...t){let s=this,r=e.split("?"),n=r[1]&&r[1].split("#")[0]||"",a=s.toArr(t).map((e=>e?s.FormGet(e):"")).join("&"),i=s.FormGet(n+"&"+a).toString().replace(/=&/g,"&");return r[0]+(i?"?"+i:"")}toObj(e){if(!e)return{};let t=this,s=t.X(e);return t[s+"2obj"]?t[s+"2obj"](e):t.obj(e)?e:t.array(e)?t.FromObj(e):e}toArr(e,t){if(!e)return[];let s=[],r=this,n=r.X(e);return r[n+"2arr"]?s=r[n+"2arr"](e):r.array(e)?s=e:e.byteLength||e.length?s=r.ArrFrom(e):r.obj(e)&&(s=r.entries(e)),r.func(t)?s.forEach(t):s}define(e,t,s,r,n){let a=!!n;return this.O[1].defineProperty(e,t,r?{get:()=>s,configurable:a}:s),e}defines(e,t,s,r){return s?this.toArr(t,(t=>this.define(e,t[0],t[1],1,r))):this.O[1].defineProperties(e,t),e}Json(e){let t=this,s=t.O;return t.u8buf(e)&&(e=t.decode(e)),"string"==typeof e?new s[19]("return "+e)():e}toJson(e){return JSON.stringify(this.Json(e))}empty(e){return!e||(this.str(e)?0==e.trim().length:this.array(e)?0==e.length:!!this.obj(e)&&0==this.toArr(e).length)}};F=new class{Libjs={};LibKey="script-";zipsrc="zip.min.js";extpreg={"7z":/^377ABCAF271C/,rar:/^52617221/,zip:/^504B0304/,png:/^89504E470D0A1A0A/,gif:/^47494638/,jpg:/^FFD8FF/,webp:/^52494646/,pdf:/^255044462D312E/};exttype={"text/javascript":["js"],"text/css":["css","style"],"text/html":["html","htm","php"],"text/plain":["txt"],"text/xml":["xml","vml"],image:["jpg","jpeg","png","gif","webp"],"image/svg+xml":["svg"],application:["pdf"],"application/x-zip-compressed":["zip"],"application/x-rar-compressed":["rar"],"application/x-7z-compressed":["7z"]};action={textext(e){let t=this.I,s=t.buf16str(e),r=t.ArrTest(this.extpreg,s);return r&&r[0]?r[0]:""},async rar(e,t,s){let r,n=this,a=n.I;a.blob(e)&&(!t.filename&&e.name&&(t.filename=e.name),e=a.U8(await e.arrayBuffer())),s=s||"libunrar.min.zip",n.Libjs[s]||await n.getLibjs(s,r);let i,o=n.Libjs[s];return t.process&&(i=t.filename?n.T.getLang("Decompress:")+t.filename+" --":n.T.getLang("Decompress:"),r=e=>t.process(i+(e.file?n.getname(e.file):"")+" "+a.PER(e.current,e.total),e.total,e.current)),a.Async((s=>{let a,i=new Worker(o);i.onmessage=o=>{let l=o.data,c=l.t;if(1===c)s(a||e),o.target.terminate();else if(2===c)a||(a={}),a[l.file]=l.data;else if(4===c&&l.total>0&&l.total>=l.current)r&&r(l);else if(-1==c){let r=prompt(n.T.getLang(l.message),t.password||"");if(!r)return s(e),o.target.terminate();t.unpack&&(a.password=r),t.password=r,i.postMessage({password:r})}},i.onerror=async t=>{s(e),i.terminate()},i.postMessage({contents:e,password:t.password})}))},"7z":function(e,t){return this.callaction("rar",e,t,"extract7z.zip")},async zip(e,t={}){return this.T.Libzip==this.zipsrc?this.callaction("zipjs",e,t):this.callaction("rar",e,t,this.T.Libzip)},async zipjs(e,t){t=t||{};let s=this.T;window.zip||await s.loadLibjs(s.JSpath+this.zipsrc);var r=new zip.ZipReader(new(zip[s.I.u8buf(e)?"Uint8ArrayReader":"BlobReader"])(e)),n={},a=void 0,i=async e=>{n[e.filename]=await e.getData(new zip.Uint8ArrayWriter,{onprogress:(r,n)=>t.process&&t.process(e.filename+" "+s.I.PER(r,n)),password:a})},o=async e=>{try{null==a&&(a=t.password),await i(e)}catch(t){a=window.prompt(s.getLang("Invalid password"),a),await o(e)}},l=await r.getEntries(),c=0;if(l)for(;l[c];){let e=l[c];c++,e.directory||(e.encrypted&&!a?await o(e):await i(e))}return n}};async StreamResponse(e,t,s){let r=this.I,n=s["content-length"]||0,a=this.T.getLang("process:"),i=0,o={done:!1,value:!1},l=await e.body.getReader();return new Response(new ReadableStream({async start(e){for(;!o.done;){let c=0,d="";o.value&&(c=o.value.length,i+=c,e.enqueue(o.value)),d=n&&i<n?a+r.PER(i,n):a+(i/1024).toFixed(1)+"KB",t((s.filename?s.filename+" ":"")+d,n,i,c),o=await l.read()}e.close()}}))}FetchHeader(e,t){let s=this.I,r=s.toObj(e.headers)||{};return(r["content-type"]||this.getMime(t.url.split("/").pop()||"html")).split(";").forEach(((e,t)=>{if(e=e.trim().toLowerCase(),0==t)r["content-type"]=e;else if(-1!=e.search(/=/)){let t=e.split("=");r[t[0].trim()]=t[1].trim()}})),s.assign(r,{byteLength:s.Int(r["content-length"])||0,password:r.password||r["content-password"],type:r.type||r["content-type"].split("/")[1].split("+")[0]})}async FetchStart(e){let t=this.I,{url:s,get:r,post:n}=e||{},a={};if(s=t.get(e.url,r),a.headers={},["headers","context","referrer","referrerPolicy","mode","credentials","redirect","integrity","cache"].forEach((t=>{null!=e[t]&&(a[t]=e[t])})),e.json)a.body=JSON.stringify(e.json),delete e.json,a.headers.Accept="application/json",a.method="POST";else if(n){a.method="POST";let s=(a.headers.accept||a.headers.Accept||"").toLowerCase();/(\+|\/)json/.test(s)?a.body=t.toJson(n):e.accept?(a.headers.Accept=e.accept,a.body=n):a.body=t.post(n)}return fetch(s,a)}CheckExt(e){let t=this.I,s=e.slice(0,16),r=this.bindaction("textext"),n=t.blob(s)?s.arrayBuffer():t.str(s)?t.encode(s):s;return t.await(n)?t.Async((async e=>e(r(await n)))):r(n)}async unFile(e,t={}){let s=this,r=s.I;r.await(e)&&(e=await e),r.array(e)&&(e=r.U8(e));let n=await s.CheckExt(e);return!s.action[n]||t.PassExt&&t.PassExt.includes(zip)?(r.blob(e)&&(e=r.U8(await e.arrayBuffer())),e):await s.callaction(n,e,t)}async getLibjs(e,t){let s=this,r=s.T,n=s.I,a=s.getname(e),i=a.replace(/\.zip$/,".js");if(s.Libjs[a])return s.Libjs[a];if(s.Libjs[i])return s.Libjs[i];let o=await r.getStore(r.LibStore).data(s.LibKey+i,r.version);return o||(/\.zip$/.test(a)&&await s.getLibjs(r.Libzip,t),o=await r.FetchItem({url:s.getpath(e)+"?"+r.time,store:r.LibStore,key:s.LibKey,unpack:!0,filename:i,version:r.version,process:t})),o&&(n.obj(o)?s.I.toArr(o,(e=>s.Libjs[e[0]]=e[1]&&s.URL(e[1],s.getMime(e[0])))):s.Libjs[a]=s.URL(o,s.getMime(i))),o=null,s.Libjs[a]}getname(e){return(e||"").split("/").pop().split("?")[0].split("#")[0]}getpath(e){let t=this.T;t.I;return/^(\/|https?:\/\/|static\/js\/|data\/|assets|blob\:)/.test(e)?e:t.JSpath+e}getFileText(e,t,s,r){let n=this,a=n.T.I;return r&&s&&!t?new File([e],r,{type:s}):t?a.u8buf(e)?t(e):(a.toArr(e,(s=>{/(text|javascript|xml)/.test(n.getMime(s[0]))&&(e[s[0]]=t(s[1]))})),e):e}getExt(e){return this.getname(e).split(".").pop().toLowerCase()}getKeyName(e){let t=this.getname(e).split(".");return t.pop(),t.join(".")}getMime(e){let t,s=this;return(e=s.getExt(e))&&s.I.toArr(s.exttype,(s=>s[1].includes(e)&&(t=s[0]))),"image"==t&&(t+="/"+e),t||"application/octet-stream"}URL(e,t){let s=this.I;return s.str(e)&&(/^(blob|http)/.test(e)||/^\/?[\w\-_\u4e00-\u9FA5:\/\.\?\^\+ =%&@#~]+$/.test(e))?e:(t||(t=this.getMime("js")),window.URL.createObjectURL(s.blob(e)?e:new Blob([e],{type:t})))}getevent(e){return this.I.array(e)?e:e.replace(/[\s\|,]+/g,",").split(",").filter((e=>!this.I.empty(e)))}removeURL(e){return window.URL.revokeObjectURL(e)}download(e,t,s){let r,n=this,a=n.I;s=s||n.getMime(e),a.str(e)?/^(http|blob:)/.test(e)?(r=e,e="n.js"):t&&(r=n.URL(t,s)):(r=n.URL(e,s),e=e.name||"n.js");let i=document.createElement("a");i.href=r,i.download=e,i.click(),i.remove()}DataBase={};get idb(){return window.indexedDB||window.webkitindexedDB}dbSetMap(e){let t=this,s=t.I,r=t.T,n=t.dbMap||{};n&&!n[t.dbname]&&(n[t.dbname]=r.DB_STORE_MAP);let a=e.store;if(a){let r=e.dbName||t.dbname;if(r&&!n[r]&&(n[r]={}),a&&!n[r][a]){n[r][a]={};let t=e.dbIndex;t&&(s.str(t)?n[r][a][t]=!1:s.assign(n[r][a],t))}}return t.dbMap||(t.dbMap=n),n}async dbLoad(e){let t=this,s=(e=e||{}).dbName||t.dbname,r=e.store,n=t.DataBase[s];return r&&t.dbCheckTable(r,n)||!r&&n?n:(e.dbName=s,await t.dbInstall(t.dbSetMap(e)),t.DataBase[s])}async dbInstall(e){let t=this,s=t.I;return await s.Async(s.toArr(e).map((async e=>{let r,[n,a]=e,i=t.DataBase[n];if(i){if(!s.toArr(a).filter((e=>!t.dbCheckTable(e[0],i))).length)return"ok";r=i.version+1,i.close(),delete t.DataBase[n]}let o=s.Keys(a);return t.DataBase[n]=await t.dbOpen(n,a,r,{success:async(e,s)=>t.dbCheckTable(o,e)!=o.length?(r=t.dbClose(e),s(await t.dbOpen(n,a,r))):s(e)}),n})))}async dbOpen(e,t,s,r){let n=this,a=n.T;return n.I.Async(((i,o)=>{let l=n.idb.open(e,s);a.on(l,"error",(async e=>{o(e)})),a.on(l,"upgradeneeded",(async e=>{let s=l.result;r&&r.upgradeneeded?await r.upgradeneeded.apply(l,[s]):t&&await n.dbCreateObject(t,s)})),a.on(l,"success",(async e=>{let t=l.result;if(r&&r.success)return await r.success(t,i);i(t)}))}))}async dbCreateObject(e,t){if(!e||!t)return;let s=this,r=s.I;await r.Async(r.toArr(e).map((async e=>{let[n,a]=e;if(!s.dbCheckTable(n,t)){let e=await t.createObjectStore(n);a&&r.toArr(a,(t=>e.createIndex(t[0],t[1]&&t[1].key||t[0],t[1]&&t[1].options||t[1]||{unique:!1})))}})))}dbCheckTable(e,t,s){return t?(this.I.str(e)&&(e=[e]),e=e?e.filter((e=>t.objectStoreNames.contains(e))):[],s?e:e.length):0}async dbCheckSize(e,t){let s=this.I;s.await(e)&&(e=await e);let r=e.contents||e,n={};return s.str(r)&&r.length>t?(r=s.encode(r),s.assign(n,{contents:r,filesize:r.byteLength,type:"String"})):s.blob(r)&&r.size>t?s.assign(n,{contents:s.U8(await r.arrayBuffer()),filetype:r.type,filesize:r.size,filename:r.name,type:"File"}):r.byteLength&&r.byteLength>t&&(r=s.U8(r),s.assign(n,{contents:r,filesize:r.byteLength,type:s.N(11)})),n.contents&&(e.type||n.type||(n.type=s.N(11)),e.contents?(delete e.contents,s.assign(e,n)):e=n),e.contents&&["version","password"].forEach((t=>!e[t]&&delete e[t])),e}async dbSelect(e,t){let s=this;s.T;s.I.str(e)&&(e={store:e}),e.store instanceof s.StoreDatabase&&(e.store=e.store.table);let r=e.store,n=await s.dbLoad(e);t=t?"readonly":"readwrite",r||(r=n.objectStoreNames[0]);let a=n.transaction([r],t);return a.onerror=e=>{throw e.preventDefault(),a.error},a.objectStore(r)}async dbGetItem(e){let t=this.I;t.str(e)&&(e={name:e});let s=e.name,r=await this.dbSelect(e,!0);if(s)return t.Async((e=>{r.get(s).onsuccess=t=>e(t.target.result)}))}async dbPutItem(e){let t=this.I,{data:s,name:r}=e||{},n=await this.dbSelect(e);return t.Async((e=>{n.put(s,r).onsuccess=t=>e(t.target.result)}))}async dbRemoveItem(e){let t=this.I;t.str(e)&&(e={name:e});let s=e.name,r=await this.dbSelect(e);if(s)return t.Async(((e,t)=>{r.delete(s).onsuccess=t=>e(`delete:${s}`)}))}async dbGetAll(e){let t=this,s=t.I,r=t.T,n=await t.dbSelect(e,!0);return s.Async((a=>{let i={};e.index&&(n=n.index(e.index)),n.openCursor(e.Range).onsuccess=n=>{let o=n.target.result;if(o){if(e.only&&r.part&&r.maxsize&&s.u8buf(o.value.contents)&&o.value.filesize>r.maxsize){let e=o.primaryKey.split(r.part),n=e[0],a=e[1]||0;if(i[n])i[n].contents.set(o.value.contents,a*r.maxsize);else{let e=s.U8(o.value.filesize);e.set(o.value.contents,a*r.maxsize),delete o.value.contents,i[n]=t.assign(o.value,{contents:e})}}else i[o.primaryKey]=o.value;o.continue()}else a(i)}}))}async dbGetKeys(e){let t=this,s=t.I;s.str(e)&&(e={dbName:e});let r=await t.dbSelect(e,!0);return s.Async((n=>e.index&&r.indexNames.contains(e.index)?r.index(e.index).getAllKeys(e.Range).onsuccess=r=>{n(e.only?s.toArr(r.target.result).filter((e=>!e.includes(t.T.part))):r.target.result)}:r.getAllKeys().onsuccess=r=>{n(e.only?s.toArr(r.target.result).filter((e=>!e.includes(t.T.part))):r.target.result)}))}async dbGetCursor(e){let t=this,s=t.I;s.str(e)&&(e={index:e});let r=e.index,n=t.T,a=await t.dbSelect(e,!0),i=a.indexNames.length;if(i&&!r)r=a.indexNames[0];else if(!i)return t.dbGetKeys(e);return s.Async((t=>{let i={};a.index(r).openKeyCursor(e.Range).onsuccess=a=>{let o=a.target.result;o?((!e.only||n.part&&!o.primaryKey.includes(n.part))&&(i[o.primaryKey]=s.FromObj([[r,o.key]])),o.continue()):t(i)}}))}async dbRemoveTable(e,t){let s=this,r=s.I;return r.str(e)&&(e=[e]),await r.Async(e.map((async e=>{(await s.dbSelect({store:e,dbName:t})).clear()})))}dbClose(e){let t=this,s=t.I.str(e),r=s?t.DataBase[e]:e;if(r){let n=r.version+1;return r.close(),s&&delete t.DataBase[e],n}}async deleteDatabase(e,t){let s=this;if(t=t||s.dbname,!e)return s.idb.deleteDatabase(t||s.dbname);let r=s.DataBase[t]||await s.dbOpen(t);if(r&&!s.dbCheckTable(e,r))return"ok";let n=s.dbClose(r);return delete s.DataBase[t],await s.dbOpen(t,null,n,{upgradeneeded(t){t.deleteObjectStore(e)},success(e,t){s.close(e),t("ok")}})}get dbname(){return this.T.DB_NAME}constructor(e){let t=this,s=e.I;e.Libzip||(e.Libzip=t.zipsrc),s.defines(t,{I:s,T:e},1),t.callaction=e.callaction,t.bindaction=e.bindaction}StoreDatabase=class{constructor(e,t,s){s=s||e.DB_NAME;let r=e.I,n=`var I = T.I;I.defines(S, { T,I,table:'${t}',dbName:'${s}' }, 1,1);`;r.toArr(["getItem","setItem","removeItem","getAllData","getContent","setContent","getAllKeys","getAllCursor","clearDB","deleteDB"],(e=>{n+=`I.define(S, '${e}', {value(){let arr = ['${t}'].concat(I.toArr(arguments));return T.${e}.apply(T, arr);}});`})),new Function("S","T",n)(this,e)}setName(e){let t=this.I;return e&&"boolean"!=typeof e?t.str(e)&&(e={dbName:e}):e={dbName:this.dbName},e}get(e,t,s){return s=this.setName(s),this.getItem(e,t,s)}put(e,t){return this.setItem(e,t,this.dbName)}remove(e,t){return t=this.setName(t),this.removeItem(e,t)}data(e,t,s){return this.getData(e,t,s)}getData(e,t,s){return s=this.setName(s),this.getContent(e,t,s)}setData(e,t,s){return this.setContent(e,t,s,this.dbName)}keys(e){return this.getAllKeys(this.dbName,e||{})}cursor(e,t,s){return s=this.setName(s),this.getAllCursor(e,t,s)}all(e,t){return t=this.setName(t),this.getAllData(e,t)}clear(){return this.clearDB(this.dbName)}delete(){return this.deleteDB(this.dbName)}async getBatch(e,t){let s=await this.I.Async(e.map((async e=>await this.get(e))));return t?t(s):s}};Nttr=class{constructor(e,t){let s=(t=t||Nenge).I;if(s.defines(this,{T:t,I:s},1,1),s.str(e)&&(e=t.$(e)),s.elm(e)?(this.obj=e,e.Nttr?this.resetNttr(e.Nttr):this.obj=e):this.resetNttr(e),!this.obj)throw"Nttr error";s.defines(this.obj,{Nttr:this},1,!0)}resetNttr(e){let t=this,s=t.I;e instanceof this.constructor&&(t.eventList=s.assign({},e.eventList),t.obj=e.obj,s.DP(e.obj,"Nttr"))}eventList={};get cList(){return this.obj.classList}get active(){return this.contains("active")}set active(e){this.cList[e?"add":"remove"]("active")}get show(){return this.contains("show")}set show(e){this.cList[e?"add":"remove"]("show")}get hidden(){return this.obj.hidden}set hidden(e){return this.obj.hidden=e,this}get css(){return this.obj.style.cssText}set css(e){this.obj.style.cssText=e}get style(){return this.I.toObj(this.obj.style)}set style(e){if(this.I.str(e))return this.css=e;this.I.assign(this.obj.style,e)}html(e){return null!=e?(this.obj.innerHTML=e,this):this.obj.innerHTML}$(e){return this.obj.querySelector(e)}$$(e){return this.obj.querySelectorAll(e)}contains(e){return this.cList.contains(e)}get attrs(){return this.T.I.toObj(this.obj.attributes)}set attrs(e){this.T.I.toArr(e,(e=>this.setAttr(e[0],e[1])))}attr(e,t){return void 0===t?this.obj.getAttribute(e):null==t?this.obj.removeAttribute(e):(this.obj.setAttribute(e,t),this)}getAttrs(e){return e?this.attr(e):this.attrs}setAttrs(e,t){return t||"string"==typeof e?(this.attr(e,t),this):this.attrs=e}addClass(e){return this.cList.add(e),this}removeClass(e){return this.cList.remove(e),this}addChild(e){return this.obj.appendChild(e),this}appendTo(e){return(e=e||document.body).appendChild(this.obj),this}on(e,t,s){let r=this;return r.eventList[e]||(r.eventList[e]=[]),r.eventList[e].push({func:t,opt:s}),r.T.on(r.obj,e,t,s),r}un(e,t){let s=this;if(s.eventList[e]){let r=[];s.eventList[e].forEach((n=>{let{func:a,opt:i}=n;t&&t!=a?r.push(n):s.removeEvent(e,a,i)})),s.eventList[e]=[],r.length>0&&(s.eventList[e]=r)}else e||s.I.toArr(s.eventList,(e=>{e[1].forEach((t=>{let{func:r,opt:n}=t;s.removeEvent(e[0],r,n)})),delete s.eventList[e[0]]}));return s}once(e,t,s){return this.T.once(this.obj,e,t,s),N}removeEvent(e,t,s){return this.T.un(this.obj,e,t,s)}triger(e,t){let s=this,r=s.T;r.I;s.eventList[e]?s.eventList[e].forEach((e=>e.func.call(s.obj,t))):r.triger(s.obj,e,t)}bind(e,t){let s=this,r=s.T,n=s.I;t||(t=s.I.mobile?"touchend":"click"),n.toArr(e,(e=>r.on(s.$(e[0],this.obj),t,e[1])))}click(e,t,s){let r=this,n=r.I;return t||(t=n.mobile?"touchend":"click"),n.func(e)?(r.un(t),r.on(t,e,s||!1)):r.triger(t,e),r}getBoundingClientRect(){return this.obj.getBoundingClientRect()}remove(){this.un(),this.obj.remove()}get children(){return this.I.toArr(this.obj.children)}get parentNode(){return this.obj.parentNode}get rect(){return this.getBoundingClientRect()}};nWindow=class extends this.Nttr{action={close(){this.hidden=!0},show(){this.hidden=!1},installWindow(){this.addClass("ajaxWindow"),this.html('<div class="container">\n                    <div class="a-header">\n                        <div class="title"><span class="loading">&#61712;</span></div>\n                        <div class="menu">\n                            <button type="button" class="close" data-naction="close">&#61453;</button>\n                        </div>\n                    </div>\n                    <div class="a-body">\n                        <p class="loading">&#61473;</p>\n                    </div>\n                    <div class="a-footer" hidden></div>\n                </div>')},installHeaderEvent(){let e,t=this,s=t.T;e=s.I.mobile?["touchstart","touchmove","touchend"]:["mousedown","mousemove","mouseup","mouseout"],e.forEach((e=>s.on(t.$(".a-header"),e,(e=>{if(("mousedown"==e.type||"touchstart"==e.type)&&e){let{clientX:s,clientY:r}="mousedown"==e.type?e:e.touches[0];t.HeaderPointPos={clientX:s,clientY:r}}if("mouseup"!=e.type&&"mouseout"!=e.type&&"touchend"!=e.type||(t.HeaderPointPos=!1),("mousemove"==e.type||"touchmove"==e.type)&&t.HeaderPointPos){let{clientX:s,clientY:r}="mousemove"==e.type?e:e.touches[0],n=t.$(".container"),a=n.getBoundingClientRect(),i="",o="",l=t.HeaderPointPos.clientX-s,c=t.HeaderPointPos.clientY-r;o=a.top-c,o="top:"+o+"px;bottom:unset;",l=l||0,i=a.left-l,(i<10||i&&a.width+i+15>window.innerWidth)&&(i=parseFloat(n.style.left),i<=10?i=10:i+10>window.innerWidth&&(i-=10)),i="left:"+i+"px;right:unset;width:"+a.width+"px;",t.$(".container").style.cssText=i+o,t.HeaderPointPos={clientX:s,clientY:r}}}))),{passive:!1})},installEvent(){let e=this,t=e.T,s=e.obj;t.on(s,"pointerup",(r=>{let n=r.target;if(n==s)return e.callaction("close",n,r);let a=n&&t.attr(n,"data-naction");return a?(t.stopEvent(r),e.callaction(a,n,r)):void 0}))},initConfig(e){let t=this,s=t.T;e&&s.I.toArr(e,(e=>{"function"==typeof t[e[0]]&&t[e[0]](e[1])}))}};constructor(e,t,s){if(super(e,t),!this.obj)return;const r=this;r.callaction=t.callaction,r.$(".container")||r.callaction("installWindow"),r.callaction("installEvent"),r.callaction("installHeaderEvent"),r.callaction("initConfig",s)}title(e){this.$(".a-header .title").innerHTML=e}body(e){this.$(".a-body").innerHTML=e}footer(e){this.$(".a-footer").innerHTML=e}hiddenFooter(){this.$(".a-footer").hidden=!0}hiddenPath(e,t){this.$(".a-"+e).hidden=t||!1}}}(this)},Nttr=e=>{let t=Nenge,s=t.F,r=t.$(e);return e instanceof s.Nttr?e:r?r.Nttr?r.Nttr:new s.Nttr(r,t):void 0},nWindow=(e,t)=>{let s,r=Nenge,n=r.F;return e?(s=r.$(e),!s||s.Nttr instanceof n.nWindow||new n.nWindow(s,r,t),s&&s.Nttr):new n.nWindow(r.$ce("div"),r,t).appendTo()};Nenge.triger(document,"NengeLoad",Nenge);